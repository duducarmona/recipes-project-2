<main id="add-recipe">

  <h1>Add recipe</h1>

  <form action="/recipes" method="post">
    <label for="title">Title:</label><br>
    <input type="text" name="title" required><br>

    <label for="image">Image:</label><br>
    <input type="text" name="image"><br>

    <p>Ingredients</p>
    <div id="ingredient" class="ingredient">
      <label for="ingredient">Ingredient:</label><br>
      <select name="ingredient" required>
          <option value="">--Please choose an ingredient--</option>
          {{#each ingredients}}
            <option value={{this._id}}>{{this.name}}</option>
          {{/each}}
      </select><br>

      <label for="amount">Amount:</label><br>
      <input type="number" name="amount" step="any" min="0"><br>

      <label for="unit">Unit:</label><br>
      <input type="text" name="unit"><br>
      <button class="delete-button delete-ingredient" type="button"><img src="/images/trash-icon-20.png" alt="trash icon"/></button>
    </div>
    <button class="small-button" type="button" id="add-ingredient">Add another ingredient</button>

    <p>Instructions</p>
    <div>
      <ol id="steps">
        <li>
          <input class="step" type="text" name="steps">
          <button class="delete-button delete-step" type="button"><img src="/images/trash-icon-20.png" alt="trash icon"/></button>
        </li>
      </ol>
    </div>
    <button class="small-button" type="button" id="add-step">Add step</button>

    <br>
    <button class="button" type="submit">Save Recipe</button>
  </form>

</main>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const steps = document.getElementById('steps');
    document.getElementById('add-step').addEventListener('click', () => {
      const newStep = document.createElement('li');
      newStep.innerHTML = `
      <input class="step" type="text" name="steps">
      <button class="delete-button delete-step" type="button"><img src="/images/trash-icon-20.png" alt="trash icon"/></button><br>
      `;
      steps.appendChild(newStep);

      {{!-- Delete step --}}
      document.querySelectorAll('.delete-step').forEach(deleteButton => {
        deleteButton.addEventListener('click', () => {
          const rowToDelete = deleteButton.parentNode;
          deleteButton.parentNode.parentNode.removeChild(rowToDelete);
        });
      });
    });

    {{!-- Add ingredient --}}
    const addIngredient = document.getElementById('add-ingredient');
    document.getElementById('add-ingredient').addEventListener('click', () => {
      const newIngredient = document.createElement('div');
      newIngredient.classList.add("ingredient");
      newIngredient.innerHTML = `
      <label for="ingredient">Ingredient:</label><br>
      <select name="ingredient">
          <option value="">--Please choose an ingredient--</option>
          {{#each ingredients}}
            <option value={{this._id}}>{{this.name}}</option>
          {{/each}}
      </select><br>

      <label for="amount">Amount:</label><br>
      <input type="number" name="amount" step="any" min="0"><br>

      <label for="unit">Unit:</label><br>
      <input type="text" name="unit"><br>
      <button class="delete-button delete-ingredient" type="button"><img src="/images/trash-icon-20.png" alt="trash icon"/></button>
      `;
      
      addIngredient.insertAdjacentElement('beforebegin', newIngredient);

      {{!-- Delete ingredient --}}
      document.querySelectorAll('.delete-ingredient').forEach(deleteButton => {
        deleteButton.addEventListener('click', () => {
          const rowToDelete = deleteButton.parentNode;

          deleteButton.parentNode.parentNode.removeChild(rowToDelete);
        });
      });
    });
  });
</script>
